<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TaskFlow - Organise ta vie</title>
  <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 40 40'%3E%3Cdefs%3E%3ClinearGradient id='g' x1='0%25' y1='0%25' x2='100%25' y2='100%25'%3E%3Cstop offset='0%25' stop-color='%238b5cf6'/%3E%3Cstop offset='100%25' stop-color='%23ec4899'/%3E%3C/linearGradient%3E%3C/defs%3E%3Ccircle cx='20' cy='20' r='18' fill='none' stroke='%2327272a' stroke-width='3.5'/%3E%3Ccircle cx='20' cy='20' r='18' fill='none' stroke='url(%23g)' stroke-width='3.5' stroke-linecap='round' stroke-dasharray='113' stroke-dashoffset='28' transform='rotate(-90 20 20)'/%3E%3Cpath d='M12 20l5 5 11-11' fill='none' stroke='%238b5cf6' stroke-width='3' stroke-linecap='round' stroke-linejoin='round'/%3E%3C/svg%3E">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,400;0,9..40,500;0,9..40,600;0,9..40,700;1,9..40,400&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
  <style>
    :root {
      /* Colors */
      --bg-primary: #0a0a0b;
      --bg-secondary: #141416;
      --bg-tertiary: #1c1c1f;
      --bg-card: #1a1a1d;
      --bg-hover: #232326;
      --text-primary: #fafafa;
      --text-secondary: #a1a1aa;
      --text-muted: #71717a;
      --border: #27272a;
      --border-light: #3f3f46;
      
      /* Priority colors */
      --priority-high: #ef4444;
      --priority-high-bg: rgba(239, 68, 68, 0.15);
      --priority-medium: #f97316;
      --priority-medium-bg: rgba(249, 115, 22, 0.15);
      --priority-low: #22c55e;
      --priority-low-bg: rgba(34, 197, 94, 0.15);
      
      /* Accent */
      --accent: #8b5cf6;
      --accent-hover: #7c3aed;
      
      /* Spacing */
      --radius: 12px;
      --radius-sm: 8px;
    }

    [data-theme="light"] {
      --bg-primary: #fafafa;
      --bg-secondary: #f4f4f5;
      --bg-tertiary: #e4e4e7;
      --bg-card: #ffffff;
      --bg-hover: #f4f4f5;
      --text-primary: #18181b;
      --text-secondary: #52525b;
      --text-muted: #a1a1aa;
      --border: #e4e4e7;
      --border-light: #d4d4d8;
      --priority-high-bg: rgba(239, 68, 68, 0.1);
      --priority-medium-bg: rgba(249, 115, 22, 0.1);
      --priority-low-bg: rgba(34, 197, 94, 0.1);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'DM Sans', sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      min-height: 100vh;
      line-height: 1.5;
    }

    /* Layout */
    .app {
      display: flex;
      min-height: 100vh;
    }

    /* Sidebar */
    .sidebar {
      width: 280px;
      background: var(--bg-secondary);
      border-right: 1px solid var(--border);
      padding: 24px 16px;
      display: flex;
      flex-direction: column;
      position: fixed;
      height: 100vh;
      overflow-y: auto;
      z-index: 100;
      transition: transform 0.3s ease;
    }

    .sidebar-header {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 32px;
      padding: 0 8px;
    }

    .logo {
      width: 42px;
      height: 42px;
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .logo svg.ring {
      width: 100%;
      height: 100%;
      transform: rotate(-90deg);
    }

    .logo .ring .bg {
      fill: none;
      stroke: var(--border);
      stroke-width: 3.5;
    }

    .logo .ring .progress {
      fill: none;
      stroke: url(#logoGradient);
      stroke-width: 3.5;
      stroke-linecap: round;
      stroke-dasharray: 113;
      stroke-dashoffset: 28;
    }

    .logo .check-icon {
      position: absolute;
      width: 18px;
      height: 18px;
      color: var(--accent);
    }

    .logo-text {
      font-family: 'DM Sans', sans-serif;
      font-size: 20px;
      font-weight: 700;
      letter-spacing: -0.5px;
    }

    .logo-text-flow {
      color: var(--text-muted);
      font-weight: 400;
    }

    .nav-section {
      margin-bottom: 24px;
    }

    .nav-title {
      font-size: 11px;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: var(--text-muted);
      padding: 0 12px;
      margin-bottom: 8px;
    }

    .nav-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 10px 12px;
      border-radius: var(--radius-sm);
      cursor: pointer;
      transition: all 0.15s ease;
      color: var(--text-secondary);
      font-size: 14px;
      font-weight: 500;
    }

    .nav-item:hover {
      background: var(--bg-hover);
      color: var(--text-primary);
    }

    .nav-item.active {
      background: var(--accent);
      color: white;
    }

    .nav-item svg {
      width: 18px;
      height: 18px;
      flex-shrink: 0;
    }

    .nav-item .count {
      margin-left: auto;
      background: var(--bg-tertiary);
      padding: 2px 8px;
      border-radius: 10px;
      font-size: 12px;
      font-weight: 600;
    }

    .nav-item.active .count {
      background: rgba(255,255,255,0.2);
    }

    .category-item {
      display: flex;
      align-items: center;
      gap: 10px;
      padding: 10px 12px;
      border-radius: var(--radius-sm);
      cursor: pointer;
      transition: all 0.15s ease;
      color: var(--text-secondary);
      font-size: 14px;
      position: relative;
    }

    .category-item:hover {
      background: var(--bg-hover);
      color: var(--text-primary);
    }

    .category-item.active {
      background: var(--bg-tertiary);
      color: var(--text-primary);
    }

    .category-dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      flex-shrink: 0;
    }

    .category-actions {
      margin-left: auto;
      display: flex;
      gap: 4px;
      opacity: 0;
      transition: opacity 0.15s;
    }

    .category-item:hover .category-actions {
      opacity: 1;
    }

    .category-btn {
      background: none;
      border: none;
      padding: 4px;
      cursor: pointer;
      color: var(--text-muted);
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .category-btn:hover {
      background: var(--bg-tertiary);
      color: var(--text-primary);
    }

    .category-btn svg {
      width: 14px;
      height: 14px;
    }

    .add-category-btn {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 10px 12px;
      color: var(--text-muted);
      font-size: 14px;
      cursor: pointer;
      border-radius: var(--radius-sm);
      transition: all 0.15s;
    }

    .add-category-btn:hover {
      background: var(--bg-hover);
      color: var(--text-secondary);
    }

    .add-category-btn svg {
      width: 16px;
      height: 16px;
    }

    .sidebar-footer {
      margin-top: auto;
      padding-top: 16px;
      border-top: 1px solid var(--border);
    }

    .theme-toggle {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 10px 12px;
      border-radius: var(--radius-sm);
      cursor: pointer;
      color: var(--text-secondary);
      font-size: 14px;
      transition: all 0.15s;
    }

    .theme-toggle:hover {
      background: var(--bg-hover);
      color: var(--text-primary);
    }

    .theme-toggle svg {
      width: 18px;
      height: 18px;
    }

    /* Main Content */
    .main {
      flex: 1;
      margin-left: 280px;
      padding: 24px 32px;
      max-width: 1200px;
    }

    .main-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 24px;
    }

    .page-title {
      font-size: 28px;
      font-weight: 700;
      letter-spacing: -0.5px;
    }

    .page-subtitle {
      color: var(--text-muted);
      font-size: 14px;
      margin-top: 4px;
    }

    .header-actions {
      display: flex;
      gap: 12px;
    }

    .search-box {
      position: relative;
    }

    .search-box input {
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      padding: 10px 12px 10px 40px;
      font-size: 14px;
      color: var(--text-primary);
      width: 240px;
      transition: all 0.15s;
      font-family: inherit;
    }

    .search-box input:focus {
      outline: none;
      border-color: var(--accent);
      background: var(--bg-tertiary);
    }

    .search-box input::placeholder {
      color: var(--text-muted);
    }

    .search-box svg {
      position: absolute;
      left: 12px;
      top: 50%;
      transform: translateY(-50%);
      width: 18px;
      height: 18px;
      color: var(--text-muted);
    }

    .btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 16px;
      border-radius: var(--radius-sm);
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.15s;
      border: none;
      font-family: inherit;
    }

    .btn-primary {
      background: var(--accent);
      color: white;
    }

    .btn-primary:hover {
      background: var(--accent-hover);
      transform: translateY(-1px);
    }

    .btn svg {
      width: 18px;
      height: 18px;
    }

    /* Dashboard Cards */
    .dashboard-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 20px;
      margin-bottom: 32px;
    }

    .stat-card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 20px;
    }

    .stat-card-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 16px;
    }

    .stat-card-title {
      font-size: 14px;
      font-weight: 500;
      color: var(--text-secondary);
    }

    .stat-card-icon {
      width: 40px;
      height: 40px;
      border-radius: var(--radius-sm);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .stat-card-icon svg {
      width: 20px;
      height: 20px;
    }

    .stat-card-icon.urgent {
      background: var(--priority-high-bg);
      color: var(--priority-high);
    }

    .stat-card-icon.today {
      background: var(--priority-medium-bg);
      color: var(--priority-medium);
    }

    .stat-card-icon.week {
      background: rgba(139, 92, 246, 0.15);
      color: var(--accent);
    }

    .stat-card-icon.done {
      background: var(--priority-low-bg);
      color: var(--priority-low);
    }

    .stat-value {
      font-size: 36px;
      font-weight: 700;
      font-family: 'Space Mono', monospace;
      letter-spacing: -1px;
    }

    .stat-label {
      font-size: 13px;
      color: var(--text-muted);
      margin-top: 4px;
    }

    /* Task Sections */
    .section {
      margin-bottom: 32px;
    }

    .section-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 16px;
    }

    .section-title {
      font-size: 18px;
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .section-title .badge {
      background: var(--bg-tertiary);
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: 600;
      color: var(--text-muted);
    }

    /* Task List */
    .task-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .task-item {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 16px;
      display: flex;
      align-items: flex-start;
      gap: 14px;
      transition: all 0.15s;
      cursor: pointer;
    }

    .task-item:hover {
      border-color: var(--border-light);
      transform: translateX(4px);
    }

    .task-item.completed {
      opacity: 0.6;
    }

    .task-item.completed .task-title {
      text-decoration: line-through;
      color: var(--text-muted);
    }

    .task-checkbox {
      width: 22px;
      height: 22px;
      border: 2px solid var(--border-light);
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-shrink: 0;
      cursor: pointer;
      transition: all 0.15s;
      margin-top: 2px;
    }

    .task-checkbox:hover {
      border-color: var(--accent);
    }

    .task-checkbox.checked {
      background: var(--priority-low);
      border-color: var(--priority-low);
    }

    .task-checkbox svg {
      width: 14px;
      height: 14px;
      color: white;
      opacity: 0;
    }

    .task-checkbox.checked svg {
      opacity: 1;
    }

    .task-content {
      flex: 1;
      min-width: 0;
    }

    .task-header {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 6px;
    }

    .task-title {
      font-size: 15px;
      font-weight: 500;
      color: var(--text-primary);
    }

    .task-priority {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      flex-shrink: 0;
    }

    .task-priority.high {
      background: var(--priority-high);
      box-shadow: 0 0 8px var(--priority-high);
    }

    .task-priority.medium {
      background: var(--priority-medium);
      box-shadow: 0 0 8px var(--priority-medium);
    }

    .task-priority.low {
      background: var(--priority-low);
    }

    .task-meta {
      display: flex;
      align-items: center;
      gap: 12px;
      flex-wrap: wrap;
    }

    .task-tag {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 4px 10px;
      border-radius: 6px;
      font-size: 12px;
      font-weight: 500;
    }

    .task-tag.category {
      background: var(--bg-tertiary);
      color: var(--text-secondary);
    }

    .task-tag.date {
      background: var(--bg-tertiary);
      color: var(--text-muted);
    }

    .task-tag.date.urgent {
      background: var(--priority-high-bg);
      color: var(--priority-high);
    }

    .task-tag.date.soon {
      background: var(--priority-medium-bg);
      color: var(--priority-medium);
    }

    .task-tag.recurrence {
      background: rgba(139, 92, 246, 0.15);
      color: var(--accent);
    }

    .task-tag svg {
      width: 12px;
      height: 12px;
    }

    .task-note {
      font-size: 13px;
      color: var(--text-muted);
      margin-top: 8px;
      display: -webkit-box;
      -webkit-line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
    }

    .task-subtasks {
      margin-top: 12px;
      padding-top: 12px;
      border-top: 1px solid var(--border);
    }

    .subtask-progress {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 12px;
      color: var(--text-muted);
    }

    .subtask-bar {
      flex: 1;
      height: 4px;
      background: var(--bg-tertiary);
      border-radius: 2px;
      overflow: hidden;
    }

    .subtask-bar-fill {
      height: 100%;
      background: var(--priority-low);
      border-radius: 2px;
      transition: width 0.3s ease;
    }

    .task-actions {
      display: flex;
      gap: 4px;
      opacity: 0;
      transition: opacity 0.15s;
    }

    .task-item:hover .task-actions {
      opacity: 1;
    }

    .task-action-btn {
      background: none;
      border: none;
      padding: 6px;
      cursor: pointer;
      color: var(--text-muted);
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.15s;
    }

    .task-action-btn:hover {
      background: var(--bg-tertiary);
      color: var(--text-primary);
    }

    .task-action-btn.delete:hover {
      background: var(--priority-high-bg);
      color: var(--priority-high);
    }

    .task-action-btn svg {
      width: 16px;
      height: 16px;
    }

    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: var(--text-muted);
    }

    .empty-state svg {
      width: 64px;
      height: 64px;
      margin-bottom: 16px;
      opacity: 0.5;
    }

    .empty-state h3 {
      font-size: 18px;
      font-weight: 600;
      color: var(--text-secondary);
      margin-bottom: 8px;
    }

    .empty-state p {
      font-size: 14px;
    }

    /* Modal */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0, 0, 0, 0.7);
      backdrop-filter: blur(4px);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: all 0.2s ease;
    }

    .modal-overlay.active {
      opacity: 1;
      visibility: visible;
    }

    .modal {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      width: 100%;
      max-width: 520px;
      max-height: 90vh;
      overflow-y: auto;
      transform: scale(0.95) translateY(20px);
      transition: transform 0.2s ease;
    }

    .modal-overlay.active .modal {
      transform: scale(1) translateY(0);
    }

    .modal-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 20px 24px;
      border-bottom: 1px solid var(--border);
    }

    .modal-title {
      font-size: 18px;
      font-weight: 600;
    }

    .modal-close {
      background: none;
      border: none;
      padding: 8px;
      cursor: pointer;
      color: var(--text-muted);
      border-radius: 6px;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.15s;
    }

    .modal-close:hover {
      background: var(--bg-tertiary);
      color: var(--text-primary);
    }

    .modal-close svg {
      width: 20px;
      height: 20px;
    }

    .modal-body {
      padding: 24px;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-label {
      display: block;
      font-size: 13px;
      font-weight: 600;
      color: var(--text-secondary);
      margin-bottom: 8px;
    }

    .form-input {
      width: 100%;
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      padding: 12px 14px;
      font-size: 14px;
      color: var(--text-primary);
      font-family: inherit;
      transition: all 0.15s;
    }

    .form-input:focus {
      outline: none;
      border-color: var(--accent);
      background: var(--bg-tertiary);
    }

    .form-input::placeholder {
      color: var(--text-muted);
    }

    textarea.form-input {
      min-height: 80px;
      resize: vertical;
    }

    .form-row {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 16px;
    }

    .priority-selector {
      display: flex;
      gap: 8px;
    }

    .priority-option {
      flex: 1;
      padding: 10px;
      border: 2px solid var(--border);
      border-radius: var(--radius-sm);
      cursor: pointer;
      text-align: center;
      font-size: 13px;
      font-weight: 500;
      transition: all 0.15s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
    }

    .priority-option:hover {
      border-color: var(--border-light);
    }

    .priority-option.high.selected {
      border-color: var(--priority-high);
      background: var(--priority-high-bg);
      color: var(--priority-high);
    }

    .priority-option.medium.selected {
      border-color: var(--priority-medium);
      background: var(--priority-medium-bg);
      color: var(--priority-medium);
    }

    .priority-option.low.selected {
      border-color: var(--priority-low);
      background: var(--priority-low-bg);
      color: var(--priority-low);
    }

    .priority-option .dot {
      width: 8px;
      height: 8px;
      border-radius: 50%;
    }

    .priority-option.high .dot { background: var(--priority-high); }
    .priority-option.medium .dot { background: var(--priority-medium); }
    .priority-option.low .dot { background: var(--priority-low); }

    .category-selector {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .category-option {
      padding: 8px 14px;
      border: 1px solid var(--border);
      border-radius: 20px;
      cursor: pointer;
      font-size: 13px;
      transition: all 0.15s;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .category-option:hover {
      border-color: var(--border-light);
    }

    .category-option.selected {
      border-color: var(--accent);
      background: rgba(139, 92, 246, 0.15);
      color: var(--accent);
    }

    .category-option .dot {
      width: 6px;
      height: 6px;
      border-radius: 50%;
    }

    /* Subtasks in modal */
    .subtasks-container {
      margin-top: 8px;
    }

    .subtask-input-row {
      display: flex;
      gap: 8px;
      margin-bottom: 8px;
    }

    .subtask-input-row input {
      flex: 1;
    }

    .subtask-list-edit {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .subtask-edit-item {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 12px;
      background: var(--bg-secondary);
      border-radius: var(--radius-sm);
    }

    .subtask-edit-item span {
      flex: 1;
      font-size: 13px;
    }

    .subtask-edit-item button {
      background: none;
      border: none;
      padding: 4px;
      cursor: pointer;
      color: var(--text-muted);
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .subtask-edit-item button:hover {
      color: var(--priority-high);
    }

    .subtask-edit-item button svg {
      width: 14px;
      height: 14px;
    }

    /* Recurrence selector */
    .recurrence-selector {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
    }

    .recurrence-option {
      padding: 8px 12px;
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      cursor: pointer;
      font-size: 13px;
      transition: all 0.15s;
    }

    .recurrence-option:hover {
      border-color: var(--border-light);
    }

    .recurrence-option.selected {
      border-color: var(--accent);
      background: rgba(139, 92, 246, 0.15);
      color: var(--accent);
    }

    .modal-footer {
      display: flex;
      justify-content: flex-end;
      gap: 12px;
      padding: 20px 24px;
      border-top: 1px solid var(--border);
    }

    .btn-secondary {
      background: var(--bg-tertiary);
      color: var(--text-primary);
      border: 1px solid var(--border);
    }

    .btn-secondary:hover {
      background: var(--bg-hover);
    }

    .btn-danger {
      background: var(--priority-high-bg);
      color: var(--priority-high);
    }

    .btn-danger:hover {
      background: var(--priority-high);
      color: white;
    }

    /* Archive Section */
    .archive-header {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 16px;
      background: var(--bg-secondary);
      border-radius: var(--radius);
      margin-bottom: 16px;
      cursor: pointer;
    }

    .archive-header svg {
      width: 20px;
      height: 20px;
      color: var(--text-muted);
      transition: transform 0.2s;
    }

    .archive-header.expanded svg {
      transform: rotate(90deg);
    }

    .archive-header h3 {
      flex: 1;
      font-size: 14px;
      font-weight: 600;
    }

    .archive-header .count {
      background: var(--bg-tertiary);
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 12px;
      color: var(--text-muted);
    }

    .archive-list {
      display: none;
      flex-direction: column;
      gap: 8px;
    }

    .archive-list.visible {
      display: flex;
    }

    .archived-task {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 14px 16px;
      opacity: 0.7;
    }

    .archived-task .task-title {
      text-decoration: line-through;
      color: var(--text-muted);
    }

    .archived-date {
      font-size: 11px;
      color: var(--text-muted);
      margin-top: 8px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .archived-date svg {
      width: 12px;
      height: 12px;
    }

    /* Mobile Responsive */
    .menu-toggle {
      display: none;
      position: fixed;
      bottom: 24px;
      left: 24px;
      width: 56px;
      height: 56px;
      border-radius: 50%;
      background: var(--accent);
      color: white;
      border: none;
      cursor: pointer;
      z-index: 101;
      box-shadow: 0 4px 20px rgba(139, 92, 246, 0.4);
      align-items: center;
      justify-content: center;
    }

    .menu-toggle svg {
      width: 24px;
      height: 24px;
    }

    @media (max-width: 768px) {
      .sidebar {
        transform: translateX(-100%);
        width: 260px;
      }

      .sidebar.open {
        transform: translateX(0);
      }

      .main {
        margin-left: 0;
        padding: 20px 16px;
      }

      .menu-toggle {
        display: flex;
      }

      .header-actions {
        flex-wrap: wrap;
      }

      .search-box input {
        width: 100%;
      }

      .form-row {
        grid-template-columns: 1fr;
      }

      .modal {
        margin: 16px;
        max-height: calc(100vh - 32px);
      }

      .dashboard-grid {
        grid-template-columns: 1fr 1fr;
      }

      .stat-value {
        font-size: 28px;
      }
    }

    @media (max-width: 480px) {
      .dashboard-grid {
        grid-template-columns: 1fr;
      }

      .page-title {
        font-size: 24px;
      }
    }

    /* Animations */
    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(10px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .task-item {
      animation: slideIn 0.2s ease;
    }

    /* Category Edit Modal */
    .category-edit-input {
      display: flex;
      gap: 8px;
      align-items: center;
    }

    .color-picker {
      display: flex;
      gap: 6px;
      flex-wrap: wrap;
    }

    .color-option {
      width: 28px;
      height: 28px;
      border-radius: 50%;
      cursor: pointer;
      border: 2px solid transparent;
      transition: all 0.15s;
    }

    .color-option:hover {
      transform: scale(1.1);
    }

    .color-option.selected {
      border-color: var(--text-primary);
    }

    /* Toast notifications */
    .toast-container {
      position: fixed;
      bottom: 24px;
      right: 24px;
      z-index: 1001;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .toast {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      padding: 14px 18px;
      font-size: 14px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      display: flex;
      align-items: center;
      gap: 10px;
      animation: toastIn 0.3s ease;
    }

    .toast.success {
      border-left: 3px solid var(--priority-low);
    }

    .toast.error {
      border-left: 3px solid var(--priority-high);
    }

    @keyframes toastIn {
      from {
        opacity: 0;
        transform: translateX(100%);
      }
      to {
        opacity: 1;
        transform: translateX(0);
      }
    }
  </style>
</head>
<body>
  <div class="app">
    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <div class="logo">
          <svg class="ring" viewBox="0 0 40 40">
            <defs>
              <linearGradient id="logoGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%" stop-color="#8b5cf6"/>
                <stop offset="100%" stop-color="#ec4899"/>
              </linearGradient>
            </defs>
            <circle class="bg" cx="20" cy="20" r="18"/>
            <circle class="progress" cx="20" cy="20" r="18"/>
          </svg>
          <svg class="check-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
            <polyline points="20 6 9 17 4 12"/>
          </svg>
        </div>
        <span class="logo-text">Task<span class="logo-text-flow">Flow</span></span>
      </div>

      <nav class="nav-section">
        <div class="nav-title">Vues</div>
        <div class="nav-item active" data-view="dashboard">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <rect x="3" y="3" width="7" height="9" rx="1"/>
            <rect x="14" y="3" width="7" height="5" rx="1"/>
            <rect x="14" y="12" width="7" height="9" rx="1"/>
            <rect x="3" y="16" width="7" height="5" rx="1"/>
          </svg>
          Dashboard
        </div>
        <div class="nav-item" data-view="all">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="8" y1="6" x2="21" y2="6"/>
            <line x1="8" y1="12" x2="21" y2="12"/>
            <line x1="8" y1="18" x2="21" y2="18"/>
            <line x1="3" y1="6" x2="3.01" y2="6"/>
            <line x1="3" y1="12" x2="3.01" y2="12"/>
            <line x1="3" y1="18" x2="3.01" y2="18"/>
          </svg>
          Toutes les tâches
          <span class="count" id="all-count">0</span>
        </div>
        <div class="nav-item" data-view="archive">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <polyline points="21 8 21 21 3 21 3 8"/>
            <rect x="1" y="3" width="22" height="5"/>
            <line x1="10" y1="12" x2="14" y2="12"/>
          </svg>
          Archives
          <span class="count" id="archive-count">0</span>
        </div>
      </nav>

      <nav class="nav-section">
        <div class="nav-title">Catégories</div>
        <div id="categories-list">
          <!-- Categories dynamically inserted -->
        </div>
        <div class="add-category-btn" id="add-category-btn">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="12" y1="5" x2="12" y2="19"/>
            <line x1="5" y1="12" x2="19" y2="12"/>
          </svg>
          Ajouter une catégorie
        </div>
      </nav>

      <div class="sidebar-footer">
        <div class="theme-toggle" id="theme-toggle">
          <svg id="theme-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="5"/>
            <line x1="12" y1="1" x2="12" y2="3"/>
            <line x1="12" y1="21" x2="12" y2="23"/>
            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
            <line x1="1" y1="12" x2="3" y2="12"/>
            <line x1="21" y1="12" x2="23" y2="12"/>
            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
          </svg>
          Mode clair
        </div>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="main" id="main-content">
      <!-- Content dynamically rendered -->
    </main>

    <!-- Mobile Menu Toggle -->
    <button class="menu-toggle" id="menu-toggle">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
        <line x1="3" y1="12" x2="21" y2="12"/>
        <line x1="3" y1="6" x2="21" y2="6"/>
        <line x1="3" y1="18" x2="21" y2="18"/>
      </svg>
    </button>
  </div>

  <!-- Task Modal -->
  <div class="modal-overlay" id="task-modal">
    <div class="modal">
      <div class="modal-header">
        <h2 class="modal-title" id="modal-title">Nouvelle tâche</h2>
        <button class="modal-close" id="modal-close">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"/>
            <line x1="6" y1="6" x2="18" y2="18"/>
          </svg>
        </button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label">Titre *</label>
          <input type="text" class="form-input" id="task-title" placeholder="Qu'est-ce que tu dois faire ?">
        </div>

        <div class="form-group">
          <label class="form-label">Notes</label>
          <textarea class="form-input" id="task-notes" placeholder="Ajoute des détails si besoin..."></textarea>
        </div>

        <div class="form-group">
          <label class="form-label">Catégorie</label>
          <div class="category-selector" id="category-selector">
            <!-- Categories dynamically inserted -->
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">Priorité</label>
          <div class="priority-selector">
            <div class="priority-option high" data-priority="high">
              <span class="dot"></span>
              Urgent
            </div>
            <div class="priority-option medium selected" data-priority="medium">
              <span class="dot"></span>
              Normal
            </div>
            <div class="priority-option low" data-priority="low">
              <span class="dot"></span>
              Relax
            </div>
          </div>
        </div>

        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Date d'échéance</label>
            <input type="date" class="form-input" id="task-date">
          </div>
          <div class="form-group">
            <label class="form-label">Récurrence</label>
            <select class="form-input" id="task-recurrence">
              <option value="">Aucune</option>
              <option value="daily">Tous les jours</option>
              <option value="weekly">Toutes les semaines</option>
              <option value="monthly">Tous les mois</option>
            </select>
          </div>
        </div>

        <div class="form-group">
          <label class="form-label">Sous-tâches</label>
          <div class="subtasks-container">
            <div class="subtask-input-row">
              <input type="text" class="form-input" id="subtask-input" placeholder="Ajouter une sous-tâche">
              <button class="btn btn-secondary" id="add-subtask-btn">+</button>
            </div>
            <div class="subtask-list-edit" id="subtask-list-edit">
              <!-- Subtasks dynamically inserted -->
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-danger" id="delete-task-btn" style="display: none;">Supprimer</button>
        <button class="btn btn-secondary" id="cancel-btn">Annuler</button>
        <button class="btn btn-primary" id="save-task-btn">Enregistrer</button>
      </div>
    </div>
  </div>

  <!-- Category Modal -->
  <div class="modal-overlay" id="category-modal">
    <div class="modal" style="max-width: 400px;">
      <div class="modal-header">
        <h2 class="modal-title" id="category-modal-title">Nouvelle catégorie</h2>
        <button class="modal-close" id="category-modal-close">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="18" y1="6" x2="6" y2="18"/>
            <line x1="6" y1="6" x2="18" y2="18"/>
          </svg>
        </button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label class="form-label">Nom de la catégorie</label>
          <input type="text" class="form-input" id="category-name" placeholder="Ex: Courses, Travail...">
        </div>
        <div class="form-group">
          <label class="form-label">Couleur</label>
          <div class="color-picker" id="color-picker">
            <div class="color-option selected" data-color="#8b5cf6" style="background: #8b5cf6;"></div>
            <div class="color-option" data-color="#ec4899" style="background: #ec4899;"></div>
            <div class="color-option" data-color="#ef4444" style="background: #ef4444;"></div>
            <div class="color-option" data-color="#f97316" style="background: #f97316;"></div>
            <div class="color-option" data-color="#eab308" style="background: #eab308;"></div>
            <div class="color-option" data-color="#22c55e" style="background: #22c55e;"></div>
            <div class="color-option" data-color="#14b8a6" style="background: #14b8a6;"></div>
            <div class="color-option" data-color="#3b82f6" style="background: #3b82f6;"></div>
            <div class="color-option" data-color="#6366f1" style="background: #6366f1;"></div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-danger" id="delete-category-btn" style="display: none;">Supprimer</button>
        <button class="btn btn-secondary" id="category-cancel-btn">Annuler</button>
        <button class="btn btn-primary" id="save-category-btn">Enregistrer</button>
      </div>
    </div>
  </div>

  <!-- Toast Container -->
  <div class="toast-container" id="toast-container"></div>

  <script>
    // ==================== DATA MANAGEMENT ====================
    const DEFAULT_CATEGORIES = [
      { id: 'todo', name: 'Choses à faire', color: '#8b5cf6' },
      { id: 'shopping', name: 'Choses à acheter', color: '#ec4899' }
    ];

    let state = {
      tasks: [],
      categories: [],
      archivedTasks: [],
      currentView: 'dashboard',
      currentCategory: null,
      editingTask: null,
      editingCategory: null,
      theme: 'dark'
    };

    // Load from localStorage
    function loadData() {
      const saved = localStorage.getItem('taskflow_data');
      if (saved) {
        const data = JSON.parse(saved);
        state.tasks = data.tasks || [];
        state.categories = data.categories || DEFAULT_CATEGORIES;
        state.archivedTasks = data.archivedTasks || [];
        state.theme = data.theme || 'dark';
      } else {
        state.categories = [...DEFAULT_CATEGORIES];
      }
      applyTheme();
    }

    // Save to localStorage
    function saveData() {
      localStorage.setItem('taskflow_data', JSON.stringify({
        tasks: state.tasks,
        categories: state.categories,
        archivedTasks: state.archivedTasks,
        theme: state.theme
      }));
    }

    // ==================== UTILITY FUNCTIONS ====================
    function generateId() {
      return Date.now().toString(36) + Math.random().toString(36).substr(2);
    }

    function formatDate(dateStr) {
      if (!dateStr) return null;
      const date = new Date(dateStr);
      const today = new Date();
      today.setHours(0, 0, 0, 0);
      const tomorrow = new Date(today);
      tomorrow.setDate(tomorrow.getDate() + 1);
      
      if (date.toDateString() === today.toDateString()) return "Aujourd'hui";
      if (date.toDateString() === tomorrow.toDateString()) return 'Demain';
      
      return date.toLocaleDateString('fr-FR', { day: 'numeric', month: 'short' });
    }

    function getDaysUntil(dateStr) {
      if (!dateStr) return null;
      const date = new Date(dateStr);
      const today = new Date();
      today.setHours(0, 0, 0, 0);
      date.setHours(0, 0, 0, 0);
      return Math.ceil((date - today) / (1000 * 60 * 60 * 24));
    }

    function getEffectivePriority(task) {
      // Auto-escalade based on due date
      if (task.dueDate) {
        const daysUntil = getDaysUntil(task.dueDate);
        if (daysUntil !== null) {
          if (daysUntil < 0) return 'high'; // Overdue
          if (daysUntil <= 1) return 'high'; // Today or tomorrow
          if (daysUntil <= 3 && task.priority !== 'high') return 'medium'; // Within 3 days
        }
      }
      return task.priority;
    }

    function sortTasks(tasks) {
      const priorityOrder = { high: 0, medium: 1, low: 2 };
      
      return [...tasks].sort((a, b) => {
        const aPriority = getEffectivePriority(a);
        const bPriority = getEffectivePriority(b);
        
        // First sort by priority
        if (priorityOrder[aPriority] !== priorityOrder[bPriority]) {
          return priorityOrder[aPriority] - priorityOrder[bPriority];
        }
        
        // Same priority: tasks with dates come first
        const aHasDate = !!a.dueDate;
        const bHasDate = !!b.dueDate;
        
        if (aHasDate && !bHasDate) return -1;
        if (!aHasDate && bHasDate) return 1;
        
        // Both have dates: sort by date
        if (aHasDate && bHasDate) {
          return new Date(a.dueDate) - new Date(b.dueDate);
        }
        
        // No dates: sort by creation order (newer first for same priority)
        return new Date(b.createdAt) - new Date(a.createdAt);
      });
    }

    function getTasksForToday() {
      const today = new Date();
      today.setHours(0, 0, 0, 0);
      
      return state.tasks.filter(task => {
        if (task.completed) return false;
        if (!task.dueDate) return false;
        
        const taskDate = new Date(task.dueDate);
        taskDate.setHours(0, 0, 0, 0);
        return taskDate.getTime() === today.getTime();
      });
    }

    function getTasksForWeek() {
      const today = new Date();
      today.setHours(0, 0, 0, 0);
      const weekEnd = new Date(today);
      weekEnd.setDate(weekEnd.getDate() + 7);
      
      return state.tasks.filter(task => {
        if (task.completed) return false;
        if (!task.dueDate) return false;
        
        const taskDate = new Date(task.dueDate);
        taskDate.setHours(0, 0, 0, 0);
        return taskDate >= today && taskDate <= weekEnd;
      });
    }

    function getUrgentTasks() {
      return state.tasks.filter(task => {
        if (task.completed) return false;
        return getEffectivePriority(task) === 'high';
      });
    }

    // ==================== TOAST NOTIFICATIONS ====================
    function showToast(message, type = 'success') {
      const container = document.getElementById('toast-container');
      const toast = document.createElement('div');
      toast.className = `toast ${type}`;
      toast.innerHTML = `
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width:18px;height:18px;">
          ${type === 'success' 
            ? '<path d="M20 6L9 17l-5-5"/>' 
            : '<circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/>'}
        </svg>
        ${message}
      `;
      container.appendChild(toast);
      
      setTimeout(() => {
        toast.style.opacity = '0';
        toast.style.transform = 'translateX(100%)';
        setTimeout(() => toast.remove(), 300);
      }, 3000);
    }

    // ==================== THEME ====================
    function applyTheme() {
      document.documentElement.setAttribute('data-theme', state.theme);
      const themeToggle = document.getElementById('theme-toggle');
      const themeIcon = document.getElementById('theme-icon');
      
      if (state.theme === 'light') {
        themeToggle.innerHTML = `
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
          </svg>
          Mode sombre
        `;
      } else {
        themeToggle.innerHTML = `
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="12" cy="12" r="5"/>
            <line x1="12" y1="1" x2="12" y2="3"/>
            <line x1="12" y1="21" x2="12" y2="23"/>
            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/>
            <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
            <line x1="1" y1="12" x2="3" y2="12"/>
            <line x1="21" y1="12" x2="23" y2="12"/>
            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/>
            <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
          </svg>
          Mode clair
        `;
      }
    }

    function toggleTheme() {
      state.theme = state.theme === 'dark' ? 'light' : 'dark';
      applyTheme();
      saveData();
    }

    // ==================== RENDER FUNCTIONS ====================
    function renderCategories() {
      const container = document.getElementById('categories-list');
      container.innerHTML = state.categories.map(cat => `
        <div class="category-item ${state.currentView === 'category' && state.currentCategory === cat.id ? 'active' : ''}" 
             data-category="${cat.id}">
          <span class="category-dot" style="background: ${cat.color}"></span>
          <span>${cat.name}</span>
          <span class="count">${state.tasks.filter(t => t.categoryId === cat.id && !t.completed).length}</span>
          <div class="category-actions">
            <button class="category-btn edit-cat-btn" data-category="${cat.id}">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
              </svg>
            </button>
          </div>
        </div>
      `).join('');
      
      // Update counts in nav
      document.getElementById('all-count').textContent = state.tasks.filter(t => !t.completed).length;
      document.getElementById('archive-count').textContent = state.archivedTasks.length;
    }

    function renderCategorySelector() {
      const container = document.getElementById('category-selector');
      container.innerHTML = state.categories.map(cat => `
        <div class="category-option ${state.editingTask?.categoryId === cat.id ? 'selected' : ''}" 
             data-category="${cat.id}">
          <span class="dot" style="background: ${cat.color}"></span>
          ${cat.name}
        </div>
      `).join('');
    }

    function renderTaskItem(task) {
      const effectivePriority = getEffectivePriority(task);
      const daysUntil = getDaysUntil(task.dueDate);
      const category = state.categories.find(c => c.id === task.categoryId);
      const completedSubtasks = task.subtasks?.filter(s => s.completed).length || 0;
      const totalSubtasks = task.subtasks?.length || 0;
      
      let dateClass = '';
      if (daysUntil !== null) {
        if (daysUntil < 0) dateClass = 'urgent';
        else if (daysUntil <= 1) dateClass = 'urgent';
        else if (daysUntil <= 3) dateClass = 'soon';
      }

      const recurrenceLabels = {
        daily: 'Quotidien',
        weekly: 'Hebdo',
        monthly: 'Mensuel'
      };

      return `
        <div class="task-item ${task.completed ? 'completed' : ''}" data-task-id="${task.id}">
          <div class="task-checkbox ${task.completed ? 'checked' : ''}" data-task-id="${task.id}">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3">
              <polyline points="20 6 9 17 4 12"/>
            </svg>
          </div>
          <div class="task-content">
            <div class="task-header">
              <span class="task-priority ${effectivePriority}"></span>
              <span class="task-title">${task.title}</span>
            </div>
            <div class="task-meta">
              ${category ? `<span class="task-tag category"><span class="dot" style="background:${category.color};width:6px;height:6px;border-radius:50%;"></span>${category.name}</span>` : ''}
              ${task.dueDate ? `
                <span class="task-tag date ${dateClass}">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                    <line x1="16" y1="2" x2="16" y2="6"/>
                    <line x1="8" y1="2" x2="8" y2="6"/>
                    <line x1="3" y1="10" x2="21" y2="10"/>
                  </svg>
                  ${formatDate(task.dueDate)}
                </span>
              ` : ''}
              ${task.recurrence ? `
                <span class="task-tag recurrence">
                  <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <polyline points="23 4 23 10 17 10"/>
                    <polyline points="1 20 1 14 7 14"/>
                    <path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/>
                  </svg>
                  ${recurrenceLabels[task.recurrence]}
                </span>
              ` : ''}
            </div>
            ${task.notes ? `<div class="task-note">${task.notes}</div>` : ''}
            ${totalSubtasks > 0 ? `
              <div class="task-subtasks">
                <div class="subtask-progress">
                  <span>${completedSubtasks}/${totalSubtasks} sous-tâches</span>
                  <div class="subtask-bar">
                    <div class="subtask-bar-fill" style="width: ${(completedSubtasks/totalSubtasks)*100}%"></div>
                  </div>
                </div>
              </div>
            ` : ''}
          </div>
          <div class="task-actions">
            <button class="task-action-btn edit-btn" data-task-id="${task.id}">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"/>
                <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"/>
              </svg>
            </button>
            <button class="task-action-btn archive-btn" data-task-id="${task.id}">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <polyline points="21 8 21 21 3 21 3 8"/>
                <rect x="1" y="3" width="22" height="5"/>
                <line x1="10" y1="12" x2="14" y2="12"/>
              </svg>
            </button>
          </div>
        </div>
      `;
    }

    function renderDashboard() {
      const urgentTasks = getUrgentTasks();
      const todayTasks = getTasksForToday();
      const weekTasks = getTasksForWeek();
      const completedThisWeek = state.archivedTasks.filter(t => {
        const archiveDate = new Date(t.archivedAt);
        const weekAgo = new Date();
        weekAgo.setDate(weekAgo.getDate() - 7);
        return archiveDate >= weekAgo;
      }).length;

      const allActiveTasks = sortTasks(state.tasks.filter(t => !t.completed));

      return `
        <div class="main-header">
          <div>
            <h1 class="page-title">Dashboard</h1>
            <p class="page-subtitle">${new Date().toLocaleDateString('fr-FR', { weekday: 'long', day: 'numeric', month: 'long' })}</p>
          </div>
          <div class="header-actions">
            <div class="search-box">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="11" cy="11" r="8"/>
                <line x1="21" y1="21" x2="16.65" y2="16.65"/>
              </svg>
              <input type="text" id="search-input" placeholder="Rechercher...">
            </div>
            <button class="btn btn-primary" id="new-task-btn">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="12" y1="5" x2="12" y2="19"/>
                <line x1="5" y1="12" x2="19" y2="12"/>
              </svg>
              Nouvelle tâche
            </button>
          </div>
        </div>

        <div class="dashboard-grid">
          <div class="stat-card">
            <div class="stat-card-header">
              <span class="stat-card-title">Urgent</span>
              <div class="stat-card-icon urgent">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="10"/>
                  <line x1="12" y1="8" x2="12" y2="12"/>
                  <line x1="12" y1="16" x2="12.01" y2="16"/>
                </svg>
              </div>
            </div>
            <div class="stat-value">${urgentTasks.length}</div>
            <div class="stat-label">tâches urgentes</div>
          </div>

          <div class="stat-card">
            <div class="stat-card-header">
              <span class="stat-card-title">Aujourd'hui</span>
              <div class="stat-card-icon today">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="10"/>
                  <polyline points="12 6 12 12 16 14"/>
                </svg>
              </div>
            </div>
            <div class="stat-value">${todayTasks.length}</div>
            <div class="stat-label">à faire aujourd'hui</div>
          </div>

          <div class="stat-card">
            <div class="stat-card-header">
              <span class="stat-card-title">Cette semaine</span>
              <div class="stat-card-icon week">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <rect x="3" y="4" width="18" height="18" rx="2" ry="2"/>
                  <line x1="16" y1="2" x2="16" y2="6"/>
                  <line x1="8" y1="2" x2="8" y2="6"/>
                  <line x1="3" y1="10" x2="21" y2="10"/>
                </svg>
              </div>
            </div>
            <div class="stat-value">${weekTasks.length}</div>
            <div class="stat-label">dans les 7 jours</div>
          </div>

          <div class="stat-card">
            <div class="stat-card-header">
              <span class="stat-card-title">Complétées</span>
              <div class="stat-card-icon done">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                  <polyline points="22 4 12 14.01 9 11.01"/>
                </svg>
              </div>
            </div>
            <div class="stat-value">${completedThisWeek}</div>
            <div class="stat-label">cette semaine</div>
          </div>
        </div>

        ${urgentTasks.length > 0 ? `
          <div class="section">
            <div class="section-header">
              <h2 class="section-title">
                <svg viewBox="0 0 24 24" fill="none" stroke="var(--priority-high)" stroke-width="2" style="width:20px;height:20px;">
                  <circle cx="12" cy="12" r="10"/>
                  <line x1="12" y1="8" x2="12" y2="12"/>
                  <line x1="12" y1="16" x2="12.01" y2="16"/>
                </svg>
                Urgent
                <span class="badge">${urgentTasks.length}</span>
              </h2>
            </div>
            <div class="task-list">
              ${sortTasks(urgentTasks).map(task => renderTaskItem(task)).join('')}
            </div>
          </div>
        ` : ''}

        ${todayTasks.length > 0 ? `
          <div class="section">
            <div class="section-header">
              <h2 class="section-title">
                <svg viewBox="0 0 24 24" fill="none" stroke="var(--priority-medium)" stroke-width="2" style="width:20px;height:20px;">
                  <circle cx="12" cy="12" r="10"/>
                  <polyline points="12 6 12 12 16 14"/>
                </svg>
                Aujourd'hui
                <span class="badge">${todayTasks.length}</span>
              </h2>
            </div>
            <div class="task-list">
              ${sortTasks(todayTasks).map(task => renderTaskItem(task)).join('')}
            </div>
          </div>
        ` : ''}

        <div class="section">
          <div class="section-header">
            <h2 class="section-title">
              Toutes les tâches
              <span class="badge">${allActiveTasks.length}</span>
            </h2>
          </div>
          ${allActiveTasks.length > 0 ? `
            <div class="task-list">
              ${allActiveTasks.map(task => renderTaskItem(task)).join('')}
            </div>
          ` : `
            <div class="empty-state">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <path d="M9 5H7a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2h-2"/>
                <rect x="9" y="3" width="6" height="4" rx="1"/>
                <path d="M9 12l2 2 4-4"/>
              </svg>
              <h3>Aucune tâche</h3>
              <p>Crée ta première tâche pour commencer !</p>
            </div>
          `}
        </div>
      `;
    }

    function renderAllTasks() {
      const allActiveTasks = sortTasks(state.tasks.filter(t => !t.completed));

      return `
        <div class="main-header">
          <div>
            <h1 class="page-title">Toutes les tâches</h1>
            <p class="page-subtitle">${allActiveTasks.length} tâche${allActiveTasks.length > 1 ? 's' : ''} en cours</p>
          </div>
          <div class="header-actions">
            <div class="search-box">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="11" cy="11" r="8"/>
                <line x1="21" y1="21" x2="16.65" y2="16.65"/>
              </svg>
              <input type="text" id="search-input" placeholder="Rechercher...">
            </div>
            <button class="btn btn-primary" id="new-task-btn">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="12" y1="5" x2="12" y2="19"/>
                <line x1="5" y1="12" x2="19" y2="12"/>
              </svg>
              Nouvelle tâche
            </button>
          </div>
        </div>

        ${allActiveTasks.length > 0 ? `
          <div class="task-list">
            ${allActiveTasks.map(task => renderTaskItem(task)).join('')}
          </div>
        ` : `
          <div class="empty-state">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
              <path d="M9 5H7a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2h-2"/>
              <rect x="9" y="3" width="6" height="4" rx="1"/>
              <path d="M9 12l2 2 4-4"/>
            </svg>
            <h3>Aucune tâche</h3>
            <p>Crée ta première tâche pour commencer !</p>
          </div>
        `}
      `;
    }

    function renderCategoryView(categoryId) {
      const category = state.categories.find(c => c.id === categoryId);
      if (!category) return renderDashboard();

      const categoryTasks = sortTasks(state.tasks.filter(t => t.categoryId === categoryId && !t.completed));

      return `
        <div class="main-header">
          <div>
            <h1 class="page-title" style="display:flex;align-items:center;gap:12px;">
              <span style="width:12px;height:12px;border-radius:50%;background:${category.color};"></span>
              ${category.name}
            </h1>
            <p class="page-subtitle">${categoryTasks.length} tâche${categoryTasks.length > 1 ? 's' : ''} en cours</p>
          </div>
          <div class="header-actions">
            <div class="search-box">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="11" cy="11" r="8"/>
                <line x1="21" y1="21" x2="16.65" y2="16.65"/>
              </svg>
              <input type="text" id="search-input" placeholder="Rechercher...">
            </div>
            <button class="btn btn-primary" id="new-task-btn">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <line x1="12" y1="5" x2="12" y2="19"/>
                <line x1="5" y1="12" x2="19" y2="12"/>
              </svg>
              Nouvelle tâche
            </button>
          </div>
        </div>

        ${categoryTasks.length > 0 ? `
          <div class="task-list">
            ${categoryTasks.map(task => renderTaskItem(task)).join('')}
          </div>
        ` : `
          <div class="empty-state">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
              <path d="M9 5H7a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2h-2"/>
              <rect x="9" y="3" width="6" height="4" rx="1"/>
            </svg>
            <h3>Aucune tâche</h3>
            <p>Cette catégorie est vide</p>
          </div>
        `}
      `;
    }

    function renderArchive() {
      return `
        <div class="main-header">
          <div>
            <h1 class="page-title">Archives</h1>
            <p class="page-subtitle">${state.archivedTasks.length} tâche${state.archivedTasks.length > 1 ? 's' : ''} archivée${state.archivedTasks.length > 1 ? 's' : ''}</p>
          </div>
          <div class="header-actions">
            <div class="search-box">
              <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="11" cy="11" r="8"/>
                <line x1="21" y1="21" x2="16.65" y2="16.65"/>
              </svg>
              <input type="text" id="search-input" placeholder="Rechercher...">
            </div>
          </div>
        </div>

        ${state.archivedTasks.length > 0 ? `
          <div class="task-list">
            ${state.archivedTasks.slice().reverse().map(task => {
              const category = state.categories.find(c => c.id === task.categoryId);
              return `
                <div class="archived-task">
                  <div class="task-header">
                    <span class="task-title">${task.title}</span>
                  </div>
                  <div class="task-meta">
                    ${category ? `<span class="task-tag category"><span class="dot" style="background:${category.color};width:6px;height:6px;border-radius:50%;"></span>${category.name}</span>` : ''}
                  </div>
                  ${task.notes ? `<div class="task-note">${task.notes}</div>` : ''}
                  <div class="archived-date">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                      <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/>
                      <polyline points="22 4 12 14.01 9 11.01"/>
                    </svg>
                    Terminé le ${new Date(task.archivedAt).toLocaleDateString('fr-FR', { day: 'numeric', month: 'long', year: 'numeric' })}
                  </div>
                </div>
              `;
            }).join('')}
          </div>
        ` : `
          <div class="empty-state">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
              <polyline points="21 8 21 21 3 21 3 8"/>
              <rect x="1" y="3" width="22" height="5"/>
              <line x1="10" y1="12" x2="14" y2="12"/>
            </svg>
            <h3>Aucune archive</h3>
            <p>Les tâches terminées apparaîtront ici</p>
          </div>
        `}
      `;
    }

    function render() {
      const main = document.getElementById('main-content');
      
      // Update nav active state
      document.querySelectorAll('.nav-item').forEach(item => {
        item.classList.remove('active');
        if (item.dataset.view === state.currentView) {
          item.classList.add('active');
        }
      });

      document.querySelectorAll('.category-item').forEach(item => {
        item.classList.remove('active');
        if (state.currentView === 'category' && item.dataset.category === state.currentCategory) {
          item.classList.add('active');
        }
      });

      switch (state.currentView) {
        case 'dashboard':
          main.innerHTML = renderDashboard();
          break;
        case 'all':
          main.innerHTML = renderAllTasks();
          break;
        case 'archive':
          main.innerHTML = renderArchive();
          break;
        case 'category':
          main.innerHTML = renderCategoryView(state.currentCategory);
          break;
        default:
          main.innerHTML = renderDashboard();
      }

      renderCategories();
      attachEventListeners();
    }

    // ==================== EVENT HANDLERS ====================
    function attachEventListeners() {
      // New task button
      const newTaskBtn = document.getElementById('new-task-btn');
      if (newTaskBtn) {
        newTaskBtn.addEventListener('click', () => openTaskModal());
      }

      // Search
      const searchInput = document.getElementById('search-input');
      if (searchInput) {
        searchInput.addEventListener('input', (e) => {
          const query = e.target.value.toLowerCase();
          document.querySelectorAll('.task-item, .archived-task').forEach(item => {
            const title = item.querySelector('.task-title').textContent.toLowerCase();
            const notes = item.querySelector('.task-note')?.textContent.toLowerCase() || '';
            item.style.display = title.includes(query) || notes.includes(query) ? '' : 'none';
          });
        });
      }

      // Task checkboxes
      document.querySelectorAll('.task-checkbox').forEach(checkbox => {
        checkbox.addEventListener('click', (e) => {
          e.stopPropagation();
          const taskId = checkbox.dataset.taskId;
          toggleTaskComplete(taskId);
        });
      });

      // Task edit buttons
      document.querySelectorAll('.edit-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          e.stopPropagation();
          const taskId = btn.dataset.taskId;
          const task = state.tasks.find(t => t.id === taskId);
          if (task) openTaskModal(task);
        });
      });

      // Task archive buttons
      document.querySelectorAll('.archive-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          e.stopPropagation();
          const taskId = btn.dataset.taskId;
          archiveTask(taskId);
        });
      });

      // Category edit buttons
      document.querySelectorAll('.edit-cat-btn').forEach(btn => {
        btn.addEventListener('click', (e) => {
          e.stopPropagation();
          const categoryId = btn.dataset.category;
          const category = state.categories.find(c => c.id === categoryId);
          if (category) openCategoryModal(category);
        });
      });

      // Category click (view)
      document.querySelectorAll('.category-item').forEach(item => {
        item.addEventListener('click', () => {
          state.currentView = 'category';
          state.currentCategory = item.dataset.category;
          render();
        });
      });
    }

    function toggleTaskComplete(taskId) {
      const task = state.tasks.find(t => t.id === taskId);
      if (task) {
        task.completed = !task.completed;
        
        if (task.completed) {
          // Handle recurrence
          if (task.recurrence) {
            const newTask = { ...task, id: generateId(), completed: false };
            const dueDate = new Date(task.dueDate || new Date());
            
            switch (task.recurrence) {
              case 'daily':
                dueDate.setDate(dueDate.getDate() + 1);
                break;
              case 'weekly':
                dueDate.setDate(dueDate.getDate() + 7);
                break;
              case 'monthly':
                dueDate.setMonth(dueDate.getMonth() + 1);
                break;
            }
            
            newTask.dueDate = dueDate.toISOString().split('T')[0];
            newTask.createdAt = new Date().toISOString();
            state.tasks.push(newTask);
            showToast('Tâche récurrente créée pour ' + formatDate(newTask.dueDate));
          }
        }
        
        saveData();
        render();
      }
    }

    function archiveTask(taskId) {
      const taskIndex = state.tasks.findIndex(t => t.id === taskId);
      if (taskIndex !== -1) {
        const task = state.tasks[taskIndex];
        task.archivedAt = new Date().toISOString();
        task.completed = true;
        state.archivedTasks.push(task);
        state.tasks.splice(taskIndex, 1);
        saveData();
        render();
        showToast('Tâche archivée');
      }
    }

    // ==================== MODALS ====================
    function openTaskModal(task = null) {
      state.editingTask = task;
      const modal = document.getElementById('task-modal');
      const title = document.getElementById('modal-title');
      const deleteBtn = document.getElementById('delete-task-btn');
      
      title.textContent = task ? 'Modifier la tâche' : 'Nouvelle tâche';
      deleteBtn.style.display = task ? 'block' : 'none';

      // Reset form
      document.getElementById('task-title').value = task?.title || '';
      document.getElementById('task-notes').value = task?.notes || '';
      document.getElementById('task-date').value = task?.dueDate || '';
      document.getElementById('task-recurrence').value = task?.recurrence || '';

      // Priority
      document.querySelectorAll('.priority-option').forEach(opt => {
        opt.classList.remove('selected');
        if (opt.dataset.priority === (task?.priority || 'medium')) {
          opt.classList.add('selected');
        }
      });

      // Category selector
      renderCategorySelector();
      if (task?.categoryId) {
        document.querySelectorAll('.category-option').forEach(opt => {
          opt.classList.remove('selected');
          if (opt.dataset.category === task.categoryId) {
            opt.classList.add('selected');
          }
        });
      } else if (state.currentView === 'category' && state.currentCategory) {
        document.querySelectorAll('.category-option').forEach(opt => {
          opt.classList.remove('selected');
          if (opt.dataset.category === state.currentCategory) {
            opt.classList.add('selected');
          }
        });
      }

      // Subtasks
      const subtaskList = document.getElementById('subtask-list-edit');
      subtaskList.innerHTML = (task?.subtasks || []).map((st, i) => `
        <div class="subtask-edit-item">
          <input type="checkbox" ${st.completed ? 'checked' : ''} data-subtask-index="${i}">
          <span>${st.title}</span>
          <button data-subtask-index="${i}">
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="18" y1="6" x2="6" y2="18"/>
              <line x1="6" y1="6" x2="18" y2="18"/>
            </svg>
          </button>
        </div>
      `).join('');

      modal.classList.add('active');
    }

    function closeTaskModal() {
      state.editingTask = null;
      document.getElementById('task-modal').classList.remove('active');
    }

    function saveTask() {
      const title = document.getElementById('task-title').value.trim();
      if (!title) {
        showToast('Le titre est obligatoire', 'error');
        return;
      }

      const priority = document.querySelector('.priority-option.selected')?.dataset.priority || 'medium';
      const categoryId = document.querySelector('.category-option.selected')?.dataset.category || state.categories[0]?.id;
      const dueDate = document.getElementById('task-date').value || null;
      const recurrence = document.getElementById('task-recurrence').value || null;
      const notes = document.getElementById('task-notes').value.trim();

      // Gather subtasks
      const subtasks = [];
      document.querySelectorAll('.subtask-edit-item').forEach(item => {
        const checkbox = item.querySelector('input[type="checkbox"]');
        const titleSpan = item.querySelector('span');
        subtasks.push({
          title: titleSpan.textContent,
          completed: checkbox.checked
        });
      });

      if (state.editingTask) {
        // Update existing
        const task = state.tasks.find(t => t.id === state.editingTask.id);
        if (task) {
          task.title = title;
          task.priority = priority;
          task.categoryId = categoryId;
          task.dueDate = dueDate;
          task.recurrence = recurrence;
          task.notes = notes;
          task.subtasks = subtasks;
          task.updatedAt = new Date().toISOString();
        }
        showToast('Tâche modifiée');
      } else {
        // Create new
        state.tasks.push({
          id: generateId(),
          title,
          priority,
          categoryId,
          dueDate,
          recurrence,
          notes,
          subtasks,
          completed: false,
          createdAt: new Date().toISOString()
        });
        showToast('Tâche créée');
      }

      saveData();
      closeTaskModal();
      render();
    }

    function deleteTask() {
      if (state.editingTask) {
        const index = state.tasks.findIndex(t => t.id === state.editingTask.id);
        if (index !== -1) {
          state.tasks.splice(index, 1);
          saveData();
          closeTaskModal();
          render();
          showToast('Tâche supprimée');
        }
      }
    }

    function openCategoryModal(category = null) {
      state.editingCategory = category;
      const modal = document.getElementById('category-modal');
      const title = document.getElementById('category-modal-title');
      const deleteBtn = document.getElementById('delete-category-btn');
      
      title.textContent = category ? 'Modifier la catégorie' : 'Nouvelle catégorie';
      deleteBtn.style.display = category ? 'block' : 'none';

      document.getElementById('category-name').value = category?.name || '';

      // Color picker
      document.querySelectorAll('.color-option').forEach(opt => {
        opt.classList.remove('selected');
        if (opt.dataset.color === (category?.color || '#8b5cf6')) {
          opt.classList.add('selected');
        }
      });

      modal.classList.add('active');
    }

    function closeCategoryModal() {
      state.editingCategory = null;
      document.getElementById('category-modal').classList.remove('active');
    }

    function saveCategory() {
      const name = document.getElementById('category-name').value.trim();
      if (!name) {
        showToast('Le nom est obligatoire', 'error');
        return;
      }

      const color = document.querySelector('.color-option.selected')?.dataset.color || '#8b5cf6';

      if (state.editingCategory) {
        const cat = state.categories.find(c => c.id === state.editingCategory.id);
        if (cat) {
          cat.name = name;
          cat.color = color;
        }
        showToast('Catégorie modifiée');
      } else {
        state.categories.push({
          id: generateId(),
          name,
          color
        });
        showToast('Catégorie créée');
      }

      saveData();
      closeCategoryModal();
      render();
    }

    function deleteCategory() {
      if (state.editingCategory) {
        const index = state.categories.findIndex(c => c.id === state.editingCategory.id);
        if (index !== -1) {
          // Move tasks to first category or remove categoryId
          const newCategoryId = state.categories.find(c => c.id !== state.editingCategory.id)?.id || null;
          state.tasks.forEach(task => {
            if (task.categoryId === state.editingCategory.id) {
              task.categoryId = newCategoryId;
            }
          });
          
          state.categories.splice(index, 1);
          
          if (state.currentCategory === state.editingCategory.id) {
            state.currentView = 'dashboard';
            state.currentCategory = null;
          }
          
          saveData();
          closeCategoryModal();
          render();
          showToast('Catégorie supprimée');
        }
      }
    }

    // ==================== INITIALIZATION ====================
    function init() {
      loadData();
      render();

      // Nav items
      document.querySelectorAll('.nav-item').forEach(item => {
        item.addEventListener('click', () => {
          state.currentView = item.dataset.view;
          state.currentCategory = null;
          render();
        });
      });

      // Theme toggle
      document.getElementById('theme-toggle').addEventListener('click', toggleTheme);

      // Mobile menu toggle
      document.getElementById('menu-toggle').addEventListener('click', () => {
        document.getElementById('sidebar').classList.toggle('open');
      });

      // Close sidebar on main content click (mobile)
      document.getElementById('main-content').addEventListener('click', () => {
        document.getElementById('sidebar').classList.remove('open');
      });

      // Add category button
      document.getElementById('add-category-btn').addEventListener('click', () => openCategoryModal());

      // Task modal events
      document.getElementById('modal-close').addEventListener('click', closeTaskModal);
      document.getElementById('cancel-btn').addEventListener('click', closeTaskModal);
      document.getElementById('save-task-btn').addEventListener('click', saveTask);
      document.getElementById('delete-task-btn').addEventListener('click', deleteTask);

      document.getElementById('task-modal').addEventListener('click', (e) => {
        if (e.target.id === 'task-modal') closeTaskModal();
      });

      // Priority selector
      document.querySelectorAll('.priority-option').forEach(opt => {
        opt.addEventListener('click', () => {
          document.querySelectorAll('.priority-option').forEach(o => o.classList.remove('selected'));
          opt.classList.add('selected');
        });
      });

      // Category selector in modal
      document.getElementById('category-selector').addEventListener('click', (e) => {
        const opt = e.target.closest('.category-option');
        if (opt) {
          document.querySelectorAll('.category-option').forEach(o => o.classList.remove('selected'));
          opt.classList.add('selected');
        }
      });

      // Subtask add
      document.getElementById('add-subtask-btn').addEventListener('click', () => {
        const input = document.getElementById('subtask-input');
        const title = input.value.trim();
        if (title) {
          const list = document.getElementById('subtask-list-edit');
          const index = list.children.length;
          list.innerHTML += `
            <div class="subtask-edit-item">
              <input type="checkbox" data-subtask-index="${index}">
              <span>${title}</span>
              <button data-subtask-index="${index}">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <line x1="18" y1="6" x2="6" y2="18"/>
                  <line x1="6" y1="6" x2="18" y2="18"/>
                </svg>
              </button>
            </div>
          `;
          input.value = '';
        }
      });

      // Subtask remove
      document.getElementById('subtask-list-edit').addEventListener('click', (e) => {
        const btn = e.target.closest('button');
        if (btn) {
          btn.closest('.subtask-edit-item').remove();
        }
      });

      // Category modal events
      document.getElementById('category-modal-close').addEventListener('click', closeCategoryModal);
      document.getElementById('category-cancel-btn').addEventListener('click', closeCategoryModal);
      document.getElementById('save-category-btn').addEventListener('click', saveCategory);
      document.getElementById('delete-category-btn').addEventListener('click', deleteCategory);

      document.getElementById('category-modal').addEventListener('click', (e) => {
        if (e.target.id === 'category-modal') closeCategoryModal();
      });

      // Color picker
      document.getElementById('color-picker').addEventListener('click', (e) => {
        const opt = e.target.closest('.color-option');
        if (opt) {
          document.querySelectorAll('.color-option').forEach(o => o.classList.remove('selected'));
          opt.classList.add('selected');
        }
      });

      // Keyboard shortcuts
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape') {
          closeTaskModal();
          closeCategoryModal();
        }
        if (e.key === 'n' && !e.target.matches('input, textarea')) {
          e.preventDefault();
          openTaskModal();
        }
      });
    }

    // Start the app
    init();
  </script>
</body>
</html>
